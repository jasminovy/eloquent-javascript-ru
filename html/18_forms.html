<!doctype html>
<head>
  <meta charset="utf-8">
  <title>Forms and Form Fields :: Eloquent JavaScript</title>
  <link rel=stylesheet href="js/node_modules/codemirror/lib/codemirror.css">
  <script src="js/node_modules/codemirror/lib/codemirror.js"></script>
  <script src="js/node_modules/codemirror/mode/javascript/javascript.js"></script>
  <script src="js/node_modules/codemirror/mode/css/css.js"></script>
  <script src="js/node_modules/codemirror/mode/xml/xml.js"></script>
  <script src="js/node_modules/codemirror/mode/htmlmixed/htmlmixed.js"></script>
  <script src="js/node_modules/codemirror/addon/edit/matchbrackets.js"></script>
  <script src="js/node_modules/acorn/acorn.js"></script>
  <script src="js/node_modules/acorn/util/walk.js"></script>
  <link rel=stylesheet href="ejs.css">
  <script src="js/sandbox.js"></script>
  <script src="js/ejs.js"></script>
  <script>var chapNum = 18;var sandboxLoadFiles = ["js/promise.js"];</script>
</head>

<article>
<nav>
  <a href="17_http.html" title="previous chapter">⬅</a>
  <a href="index.html" title="cover">⬆</a>
  <a href="19_FIXME.html" title="next chapter">➡</a>
</nav>

<h1><div class=chap_num>Chapter 18</div>Forms and Form Fields</h1>
<p><a class=p_ident id="p_7R2RnNlXWq" href="#p_7R2RnNlXWq"></a>Forms were introduced briefly in the previous chapter as a way to
<em>submit</em> information entered by the user over HTTP. They were designed
for a pre-JavaScript Web, and assume that interaction with the server
always happens by navigating to a new page.</p>
<p><a class=p_ident id="p_j1nZNHqVd+" href="#p_j1nZNHqVd+"></a>But their elements are part of the DOM like the rest of the page, and
the DOM elements that represent form fields supports a number of
properties and events that are not present on other elements. These
make it possible to inspect and control them through JavaScript
programs, either to add additional functionality to a traditional
form, or by using such fields as building blocks in a JavaScript
application.</p>
<h2 id="_fields">Fields</h2>
<p><a class=p_ident id="p_pfSLM800x5" href="#p_pfSLM800x5"></a>A web form consists of any number of input fields, grouped by a
<code>&lt;form&gt;</code> tag. HTML allows a number of different styles of fields,
ranging from simple on/off checkboxes to drop-down menus and fields
for text input. This book won&#8217;t try to comprehensively discuss all of
them, but we will start with a rough overview.</p>
<p><a class=p_ident id="p_RaPZoERdpm" href="#p_RaPZoERdpm"></a>The <code>&lt;input&gt;</code> tag is used for a lot of field types. Its <code>type</code>
attribute is used to select the field&#8217;s style. These are some commonly
used types:</p>
<table>
<tr>
<td><code>text</code></td>
<td>A single-line text field</td>
</tr>
<tr>
<td><code>password</code></td>
<td>Same as above, but hides the text that is typed</td>
</tr>
<tr>
<td><code>checkbox</code></td>
<td>An on/off switch</td>
</tr>
<tr>
<td><code>radio</code></td>
<td>(Part of) a multiple choice field</td>
</tr>
<tr>
<td><code>file</code></td>
<td>Allows the user to choose a file from their computer</td>
</tr>
</table>
<p><a class=p_ident id="p_hnywMomr9S" href="#p_hnywMomr9S"></a>Form fields do not necessarily have to appear in a <code>&lt;form&gt;</code> tag. You
can put them anywhere in a page. Such fields can not be submitted
(only a form as a whole can), but when responding to input with
JavaScript, that is often not what we want anyway.</p>
<pre data-language="text/html" class="snippet cm-s-default"><a class=c_ident id="c_rOniV4QRMk" href="#c_rOniV4QRMk"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">>&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"text"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"abc"</span><span class="cm-tag cm-bracket">></span> (text)<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">>&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"password"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"abc"</span><span class="cm-tag cm-bracket">></span> (password)<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">>&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"checkbox"</span> <span class="cm-attribute">checked</span><span class="cm-tag cm-bracket">></span> (checkbox)<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">>&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"radio"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"A"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"choice"</span><span class="cm-tag cm-bracket">></span>
   <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"radio"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"B"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"choice"</span> <span class="cm-attribute">checked</span><span class="cm-tag cm-bracket">></span>
   <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"radio"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"C"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"choice"</span><span class="cm-tag cm-bracket">></span> (radio)<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">>&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"file"</span> <span class="cm-attribute">checked</span><span class="cm-tag cm-bracket">></span> (file)<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">></span></pre>
<p><a class=p_ident id="p_F4A/ei02Wb" href="#p_F4A/ei02Wb"></a>The JavaScript interface for such elements differs with the type of
the element. We&#8217;ll go over each of them later on in the chapter.</p>
<p><a class=p_ident id="p_XToRQhc0MP" href="#p_XToRQhc0MP"></a>Multi-line text fields have their own tag, <code>&lt;textarea&gt;</code>, mostly
because using an attribute to specify a multi-line starting value
would be awkward. The <code>&lt;textarea&gt;</code> requires a matching <code>&lt;/textarea&gt;</code>
closing tag, and uses the text between those two, instead of using its
<code>value</code> attribute, as starting text.</p>
<pre data-language="text/html" class="snippet cm-s-default"><a class=c_ident id="c_GmH7bvXM2W" href="#c_GmH7bvXM2W"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">textarea</span><span class="cm-tag cm-bracket">></span>
one
two
three
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">textarea</span><span class="cm-tag cm-bracket">></span></pre>
<p><a class=p_ident id="p_7RsWJ5yVTU" href="#p_7RsWJ5yVTU"></a>Finally, the <code>&lt;select&gt;</code> tag is used to create a field that allows the
user to select from a number of pre-defined options.</p>
<pre data-language="text/html" class="snippet cm-s-default"><a class=c_ident id="c_n4K3vqOnV4" href="#c_n4K3vqOnV4"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">select</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">option</span><span class="cm-tag cm-bracket">></span>Pancakes<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">option</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">option</span><span class="cm-tag cm-bracket">></span>Pudding<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">option</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">option</span><span class="cm-tag cm-bracket">></span>Ice cream<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">option</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">select</span><span class="cm-tag cm-bracket">></span></pre>
<p><a class=p_ident id="p_Po+2LjUu/R" href="#p_Po+2LjUu/R"></a>Whenever the value of a form field changes, it fires a <code>"change"</code>
event.</p>
<h2 id="_focus">Focus</h2>
<p><a class=p_ident id="p_sv9Kp9pqvi" href="#p_sv9Kp9pqvi"></a>Unlike most elements in an HTML document, form fields can get
<em>keyboard focus</em>. When clicked—or activated in some other way—they
become the currently active element, the main recipient of keyboard
input.</p>
<p><a class=p_ident id="p_sPi491t84y" href="#p_sPi491t84y"></a>If a document has a text field, text typed will only end up in there
when it is focused. Other fields respond differently to keyboard
events, for example a <code>&lt;select&gt;</code> menu will try to move to the option
that contains the text the user typed, and respond to the arrow keys
by moving its selection up and down.</p>
<p><a class=p_ident id="p_/tjC0I6by4" href="#p_/tjC0I6by4"></a>We can influence focusing from JavaScript with the <code>focus</code> and <code>blur</code>
methods. The first moves focus to the DOM element it is called on, the
second removes focus. The value in <code>document.activeElement</code>
corresponds to the currently focused element.</p>
<pre data-language="text/html" class="snippet cm-s-default"><a class=c_ident id="c_8/Dl3BMViW" href="#c_8/Dl3BMViW"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"text"</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-variable">document</span>.<span class="cm-property">querySelector</span>(<span class="cm-string">"input"</span>).<span class="cm-property">focus</span>();
  <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">document</span>.<span class="cm-property">activeElement</span>.<span class="cm-property">tagName</span>);
  <span class="cm-comment">// → INPUT</span>
  <span class="cm-variable">document</span>.<span class="cm-property">querySelector</span>(<span class="cm-string">"input"</span>).<span class="cm-property">blur</span>();
  <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">document</span>.<span class="cm-property">activeElement</span>.<span class="cm-property">tagName</span>);
  <span class="cm-comment">// → BODY</span>
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span></pre>
<p><a class=p_ident id="p_5/Idt5wdrL" href="#p_5/Idt5wdrL"></a>For some pages, it is expected that the user will want to start
interacting with a form field immediately. JavaScript can be used to
focus this field when the document is loaded, but HTML also provides
the <code>autofocus</code> attribute, which produces the same effect, but lets
the browser know what we are trying to achieve, and disable the
behavior when it is not appropriate, such as when the user has focused
something else.</p>
<pre data-language="text/html" class="snippet cm-s-default" data-focus="true"><a class=c_ident id="c_2jmj7l5rSw" href="#c_2jmj7l5rSw"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"text"</span> <span class="cm-attribute">autofocus</span><span class="cm-tag cm-bracket">></span></pre>
<p><a class=p_ident id="p_IgspvfRub5" href="#p_IgspvfRub5"></a>Browsers traditionally also allow the user to move the focus through
the document by pressing the Tab key. We can influence the order in
which elements receive focus with the <code>tabindex</code> attribute. The
example document below will let focus jump from the text input to the
“OK” button, rather than going through the help link first.</p>
<pre data-language="text/html" class="snippet cm-s-default" data-focus="true"><a class=c_ident id="c_s741hxWjMn" href="#c_s741hxWjMn"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"text"</span> <span class="cm-attribute">tabindex</span>=<span class="cm-string">1</span><span class="cm-tag cm-bracket">></span> <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">a</span> <span class="cm-attribute">href</span>=<span class="cm-string">"."</span><span class="cm-tag cm-bracket">></span>(help)<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">a</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">button</span> <span class="cm-attribute">onclick</span>=<span class="cm-string">"console.log('ok')"</span> <span class="cm-attribute">tabindex</span>=<span class="cm-string">2</span><span class="cm-tag cm-bracket">></span>OK<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">button</span><span class="cm-tag cm-bracket">></span></pre>
<p><a class=p_ident id="p_CSZoExUC/a" href="#p_CSZoExUC/a"></a>By default, most types of HTML elements can not be focused. But you
can add a <code>tabindex</code> property to any element, which will make it
focusable.</p>
<h2 id="_disabled_fields">Disabled fields</h2>
<p><a class=p_ident id="p_7L8smojOtU" href="#p_7L8smojOtU"></a>All form fields can be <em>disabled</em> through their <code>disabled</code> attribute,
which also exists as a property on the element&#8217;s DOM object. Disabled
fields can not be focused or changed. They also have a different
appearance, usually they look grey and faded.</p>
<pre data-language="text/html" class="snippet cm-s-default"><a class=c_ident id="c_lLm1oJK4gM" href="#c_lLm1oJK4gM"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">button</span><span class="cm-tag cm-bracket">></span>I'm all right<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">button</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">button</span> <span class="cm-attribute">disabled</span><span class="cm-tag cm-bracket">></span>I'm out<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">button</span><span class="cm-tag cm-bracket">></span></pre>
<p><a class=p_ident id="p_f6ZFH8bNlc" href="#p_f6ZFH8bNlc"></a>When the program is busy processing the action caused by some button
or other control, for example making requests to a server, it is often
a good idea to disable the control until the action finishes, so that
when the user gets impatient and clicks it again, they don&#8217;t
accidentally repeat their action.</p>
<h2 id="_a_forms_as_a_whole">A forms as a whole</h2>
<p><a class=p_ident id="p_naN5Aulpjw" href="#p_naN5Aulpjw"></a>When a field is contained in a <code>&lt;form&gt;</code> element, its DOM element will
have a property <code>form</code> linking back to the form&#8217;s DOM element. The
<code>&lt;form&gt;</code> element, in turn, has a property <code>elements</code> containing an
array-like collection of the fields inside of it.</p>
<p><a class=p_ident id="p_Un5dz5+I/1" href="#p_Un5dz5+I/1"></a>The <code>name</code> attribute of a form field determines the way its value will
be identified when the form is submitted. It can also be used as a
property name when accessing the form&#8217;s <code>elements</code> property, which
acts both as a pseudo-array (accessible by number) and a map
(access-able by name).</p>
<pre data-language="text/html" class="snippet cm-s-default"><a class=c_ident id="c_WRnaHbbESM" href="#c_WRnaHbbESM"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">form</span> <span class="cm-attribute">action</span>=<span class="cm-string">"example/submit.html"</span><span class="cm-tag cm-bracket">></span>
  Name: <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"text"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"name"</span><span class="cm-tag cm-bracket">>&lt;</span><span class="cm-tag">br</span><span class="cm-tag cm-bracket">></span>
  Password: <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"password"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"password"</span><span class="cm-tag cm-bracket">>&lt;</span><span class="cm-tag">br</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">button</span> <span class="cm-attribute">type</span>=<span class="cm-string">"submit"</span><span class="cm-tag cm-bracket">></span>Log in<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">button</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">form</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-keyword">var</span> <span class="cm-variable">form</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-property">querySelector</span>(<span class="cm-string">"form"</span>);
  <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">form</span>.<span class="cm-property">elements</span>[<span class="cm-number">1</span>].<span class="cm-property">type</span>);
  <span class="cm-comment">// → password</span>
  <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">form</span>.<span class="cm-property">elements</span>.<span class="cm-property">password</span>.<span class="cm-property">type</span>);
  <span class="cm-comment">// → password</span>
  <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">form</span>.<span class="cm-property">elements</span>.<span class="cm-property">name</span>.<span class="cm-property">form</span> <span class="cm-operator">==</span> <span class="cm-variable">form</span>);
  <span class="cm-comment">// → true</span>
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span></pre>
<p><a class=p_ident id="p_DOQDGp4ZWr" href="#p_DOQDGp4ZWr"></a>A button with a <code>type</code> attribute of <code>submit</code> will, when pressed, cause
the form to be submitted. Pressing Enter in when a form field is
focused has the same effect.</p>
<p><a class=p_ident id="p_lyDsHYYNuJ" href="#p_lyDsHYYNuJ"></a>When this happens, it generates a <code>"submit"</code> event. This event can be
handled by JavaScript, and the handler can even prevent the default
behavior, which is to navigate to the page indicated by the form&#8217;s
<code>action</code> attribute, by calling <code>preventDefault</code> on the event object.</p>
<pre data-language="text/html" class="snippet cm-s-default"><a class=c_ident id="c_fBDU8D55KR" href="#c_fBDU8D55KR"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">form</span> <span class="cm-attribute">action</span>=<span class="cm-string">"example/submit.html"</span><span class="cm-tag cm-bracket">></span>
  Value: <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"text"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"value"</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">button</span> <span class="cm-attribute">type</span>=<span class="cm-string">"submit"</span><span class="cm-tag cm-bracket">></span>Save<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">button</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">form</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-keyword">var</span> <span class="cm-variable">form</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-property">querySelector</span>(<span class="cm-string">"form"</span>);
  <span class="cm-variable">form</span>.<span class="cm-property">addEventListener</span>(<span class="cm-string">"submit"</span>, <span class="cm-keyword">function</span>(<span class="cm-def">event</span>) {
    <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-string">"Saving value"</span>, <span class="cm-variable">form</span>.<span class="cm-property">elements</span>.<span class="cm-property">value</span>.<span class="cm-property">value</span>);
    <span class="cm-variable-2">event</span>.<span class="cm-property">preventDefault</span>();
  });
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span></pre>
<p><a class=p_ident id="p_s3PgVwicoH" href="#p_s3PgVwicoH"></a>Intercepting <code>"submit"</code> events in JavaScript has various uses. We can
write code to verify that the values the user entered make sense, and
immediately show an error message instead of submitting the form when
they don&#8217;t. Or we can disable the regular way of submitting the form
entirely, as in the example above, and have out program handle the
input, possibly using <code>XMLHttpRequest</code> to send it over to a server
without reloading the page.</p>
<h2 id="_text_fields">Text fields</h2>
<p><a class=p_ident id="p_q3mdZKsxnm" href="#p_q3mdZKsxnm"></a>Fields created by <code>&lt;input&gt;</code> tags with a type of <code>text</code> or <code>password</code>,
as well as <code>textarea</code> tags, share a common interface. Their DOM
elements have a <code>value</code> property which holds their current content, as
a string. To change the field&#8217;s content, you can set this property to
a different string.</p>
<p><a class=p_ident id="p_Jg2Eqz7hkP" href="#p_Jg2Eqz7hkP"></a>Their <code>selectionStart</code> and <code>selectionEnd</code> give us information about
the cursor and selection in the text. When nothing is selected, these
two properties hold the same number, indicating the position of the
cursor, for example 0 to indicate the start of the text, or 10 when it
is after the 10<sup>th</sup> character. When part of the field is selected,
they will differ, giving us the start and end of the selected text.
Like <code>value</code>, these properties may also be written to.</p>
<p><a class=p_ident id="p_rd2Oz+Mt9Z" href="#p_rd2Oz+Mt9Z"></a>As an example, imagine you are writing an article about Srinivasa
Ramanujan, but have some trouble spelling his name. The code below
wires up a <code>&lt;textarea&gt;</code> tag with an event handler that, when you press
F1, inserts the string “Srinivasa Ramanujan” for you.</p>
<pre data-language="text/html" class="snippet cm-s-default"><a class=c_ident id="c_Tw5z176vDu" href="#c_Tw5z176vDu"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">textarea</span> <span class="cm-attribute">style</span>=<span class="cm-string">"width: 100%; height: 50px"</span><span class="cm-tag cm-bracket">>&lt;/</span><span class="cm-tag">textarea</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-keyword">var</span> <span class="cm-variable">text</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-property">querySelector</span>(<span class="cm-string">"textarea"</span>);
  <span class="cm-variable">text</span>.<span class="cm-property">addEventListener</span>(<span class="cm-string">"keydown"</span>, <span class="cm-keyword">function</span>(<span class="cm-def">event</span>) {
    <span class="cm-comment">// The key code for F1 happens to 112</span>
    <span class="cm-keyword">if</span> (<span class="cm-variable-2">event</span>.<span class="cm-property">keyCode</span> <span class="cm-operator">==</span> <span class="cm-number">112</span>) {
      <span class="cm-variable">replaceSelection</span>(<span class="cm-variable">text</span>, <span class="cm-string">"Srinivasa Ramanujan"</span>);
      <span class="cm-variable-2">event</span>.<span class="cm-property">preventDefault</span>();
    }
  });
  <span class="cm-keyword">function</span> <span class="cm-variable">replaceSelection</span>(<span class="cm-def">field</span>, <span class="cm-def">word</span>) {
    <span class="cm-keyword">var</span> <span class="cm-def">from</span> <span class="cm-operator">=</span> <span class="cm-variable-2">field</span>.<span class="cm-property">selectionStart</span>, <span class="cm-def">to</span> <span class="cm-operator">=</span> <span class="cm-variable-2">field</span>.<span class="cm-property">selectionEnd</span>;
    <span class="cm-variable-2">field</span>.<span class="cm-property">value</span> <span class="cm-operator">=</span> <span class="cm-variable-2">field</span>.<span class="cm-property">value</span>.<span class="cm-property">slice</span>(<span class="cm-number">0</span>, <span class="cm-variable-2">from</span>) <span class="cm-operator">+</span> <span class="cm-variable-2">word</span> <span class="cm-operator">+</span>
                  <span class="cm-variable-2">field</span>.<span class="cm-property">value</span>.<span class="cm-property">slice</span>(<span class="cm-variable-2">to</span>);
    <span class="cm-comment">// Put the cursor after the word</span>
    <span class="cm-variable-2">field</span>.<span class="cm-property">selectionStart</span> <span class="cm-operator">=</span> <span class="cm-variable-2">field</span>.<span class="cm-property">selectionEnd</span> <span class="cm-operator">=</span>
      <span class="cm-variable-2">from</span> <span class="cm-operator">+</span> <span class="cm-variable-2">word</span>.<span class="cm-property">length</span>;
  };
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span></pre>
<p><a class=p_ident id="p_Gwpy8qmRbK" href="#p_Gwpy8qmRbK"></a>The <code>replaceSelection</code> function replaces the currently selected part
of a text field&#8217;s content with the given word, and then moves the
cursor after that word, so that the user can continue typing.</p>
<p><a class=p_ident id="p_rgUvVDc6af" href="#p_rgUvVDc6af"></a>The <code>"change"</code> event for a text field does not fire every time
something is typed. Rather, it happens when the event loses focus
after its content was changed. To respond immediately to changes in a
text field, you should register a handler for the <code>"input"</code> event
instead, which fires for every character typed (or deleted, or
otherwise manipulated by the user).</p>
<p><a class=p_ident id="p_7LMjxhmHaK" href="#p_7LMjxhmHaK"></a>The example below shows a text field and a counter showing the current
length of the text entered.</p>
<pre data-language="text/html" class="snippet cm-s-default"><a class=c_ident id="c_7XyZCEbpDy" href="#c_7XyZCEbpDy"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"text"</span><span class="cm-tag cm-bracket">></span> length: <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">span</span> <span class="cm-attribute">id</span>=<span class="cm-string">"length"</span><span class="cm-tag cm-bracket">></span>0<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-keyword">var</span> <span class="cm-variable">text</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-property">querySelector</span>(<span class="cm-string">"input"</span>);
  <span class="cm-keyword">var</span> <span class="cm-variable">output</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-property">querySelector</span>(<span class="cm-string">"#length"</span>);
  <span class="cm-variable">text</span>.<span class="cm-property">addEventListener</span>(<span class="cm-string">"input"</span>, <span class="cm-keyword">function</span>() {
    <span class="cm-variable">output</span>.<span class="cm-property">textContent</span> <span class="cm-operator">=</span> <span class="cm-variable">text</span>.<span class="cm-property">value</span>.<span class="cm-property">length</span>;
  });
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span></pre>
<h2 id="_checkboxes_and_radio_buttons">Checkboxes and radio buttons</h2>
<p><a class=p_ident id="p_PD0iRdvGBQ" href="#p_PD0iRdvGBQ"></a>A checkbox field is a simple binary toggle. Its value can be extracted
or changed through its <code>checked</code> property, which holds a boolean
value.</p>
<pre data-language="text/html" class="snippet cm-s-default"><a class=c_ident id="c_LdytSV749A" href="#c_LdytSV749A"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"checkbox"</span> <span class="cm-attribute">id</span>=<span class="cm-string">"purple"</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">label</span> <span class="cm-attribute">for</span>=<span class="cm-string">"purple"</span><span class="cm-tag cm-bracket">></span>Make this page purple<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">label</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-keyword">var</span> <span class="cm-variable">checkbox</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-property">querySelector</span>(<span class="cm-string">"#purple"</span>);
  <span class="cm-variable">checkbox</span>.<span class="cm-property">addEventListener</span>(<span class="cm-string">"change"</span>, <span class="cm-keyword">function</span>() {
    <span class="cm-variable">document</span>.<span class="cm-property">body</span>.<span class="cm-property">style</span>.<span class="cm-property">background</span> <span class="cm-operator">=</span>
      <span class="cm-variable">checkbox</span>.<span class="cm-property">checked</span> <span class="cm-operator">?</span> <span class="cm-string">"mediumpurple"</span> : <span class="cm-string">""</span>;
  });
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span></pre>
<p><a class=p_ident id="p_FF1NB3YgJZ" href="#p_FF1NB3YgJZ"></a>The <code>&lt;label&gt;</code> tag is used to associate a piece of text with an input
field. Its <code>for</code> attribute should refer to the <code>id</code> of the field.
Clicking the label will activate the field (focus it, or change it in
case of a checkbox).</p>
<p><a class=p_ident id="p_vNsiBxZlre" href="#p_vNsiBxZlre"></a>A radio button is similar to a checkbox, but implicitly linked to
other radio buttons with the same <code>name</code> attribute, so that only one
of them can be active at any time.</p>
<pre data-language="text/html" class="snippet cm-s-default"><a class=c_ident id="c_FL0vBsz8hj" href="#c_FL0vBsz8hj"></a>Color:
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"radio"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"color"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"mediumpurple"</span><span class="cm-tag cm-bracket">></span> Purple
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"radio"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"color"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"lightgreen"</span><span class="cm-tag cm-bracket">></span> Green
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"radio"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"color"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"lightblue"</span><span class="cm-tag cm-bracket">></span> Blue
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-keyword">var</span> <span class="cm-variable">buttons</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-property">getElementsByName</span>(<span class="cm-string">"color"</span>);
  <span class="cm-keyword">function</span> <span class="cm-variable">setColor</span>(<span class="cm-def">event</span>) {
    <span class="cm-variable">document</span>.<span class="cm-property">body</span>.<span class="cm-property">style</span>.<span class="cm-property">background</span> <span class="cm-operator">=</span> <span class="cm-variable-2">event</span>.<span class="cm-property">target</span>.<span class="cm-property">value</span>;
  }
  <span class="cm-keyword">for</span> (<span class="cm-keyword">var</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">buttons</span>.<span class="cm-property">length</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>)
    <span class="cm-variable">buttons</span>[<span class="cm-variable">i</span>].<span class="cm-property">addEventListener</span>(<span class="cm-string">"change"</span>, <span class="cm-variable">setColor</span>);
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span></pre>
<p><a class=p_ident id="p_TLnCgOnKU5" href="#p_TLnCgOnKU5"></a>The <code>document.getElementsByName</code> method gives us all elements with a
given <code>name</code> attribute. The example loops over those (with a regular
<code>for</code> loop, not <code>forEach</code>, because the returned collection is not a
real array), and registers an event handler for each element. Remember
that event objects have a <code>target</code> property referring to the element
that triggered the event. This is often useful in event handlers like
this one, which will be called on different elements and need some way
to access the current target.</p>
<h2 id="_select_fields">Select fields</h2>
<p><a class=p_ident id="p_C43QMBKrcK" href="#p_C43QMBKrcK"></a>Select fields are conceptually similar to radio buttons—they also
allow the user to choose from a set of options. But where a radio
button puts the layout of the options under our control, the
appearance of a <code>&lt;select&gt;</code> tag is determined by the browser.</p>
<p><a class=p_ident id="p_NtH8drqnHG" href="#p_NtH8drqnHG"></a>Select fields also have a variant that is more akin to a list of
checkboxes, rather than radio boxes. When given the <code>multiple</code>
attribute, a <code>&lt;select&gt;</code> tag will allow the user to select any number
of options, rather than just a single option.</p>
<pre data-language="text/html" class="snippet cm-s-default"><a class=c_ident id="c_n4K3vqOnV4" href="#c_n4K3vqOnV4"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">select</span> <span class="cm-attribute">multiple</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">option</span><span class="cm-tag cm-bracket">></span>Pancakes<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">option</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">option</span><span class="cm-tag cm-bracket">></span>Pudding<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">option</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">option</span><span class="cm-tag cm-bracket">></span>Ice cream<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">option</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">select</span><span class="cm-tag cm-bracket">></span></pre>
<p><a class=p_ident id="p_bWeIeLEqcY" href="#p_bWeIeLEqcY"></a>This will, in most browsers, show up differently than a non-<code>multiple</code>
select field, which is commonly drawn as a <em>drop-down</em> control that
only shows the options when you <em>open</em> it. The <code>size</code> attribute to the
<code>&lt;select&gt;</code> tag allows explicit control over this—it is used to set the
amount of options that are visible at the same time. For example
setting it to <code>"3"</code> will make the field show three lines, whether it
has the <code>multiple</code> option enabled or not.</p>
<p><a class=p_ident id="p_6B1JfRLbxg" href="#p_6B1JfRLbxg"></a>Each <code>&lt;option&gt;</code> tag has a value. This value can be defined with a
<code>value</code> attribute, but when that is not given, the text inside the
option will count as the option&#8217;s value. The <code>value</code> property of a
<code>&lt;select&gt;</code> element reflects the currently selected option. For a
<code>multiple</code> field, though, this property doesn&#8217;t mean much, since it
will only give the value of <em>one</em> of the currently selected options.</p>
<p><a class=p_ident id="p_ndIcxQKWdL" href="#p_ndIcxQKWdL"></a>The <code>&lt;option&gt;</code> tags for a <code>&lt;select&gt;</code> field can be accessed as an
array-like object through its <code>options</code> property. Each option has a
property <code>selected</code>, which indicates whether that option is currently
selected. It can also be written to.</p>
<p><a class=p_ident id="p_X0nYlzrqDH" href="#p_X0nYlzrqDH"></a>The example below extracts the selected values from a <code>multiple</code>
select field, and uses them to compose a binary number from individual
bits. Hold control (or command on Mac) to select multiple options.</p>
<pre data-language="text/html" class="snippet cm-s-default"><a class=c_ident id="c_QA0JDrnTRU" href="#c_QA0JDrnTRU"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">select</span> <span class="cm-attribute">multiple</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">option</span> <span class="cm-attribute">value</span>=<span class="cm-string">"1"</span><span class="cm-tag cm-bracket">></span>0001<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">option</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">option</span> <span class="cm-attribute">value</span>=<span class="cm-string">"2"</span><span class="cm-tag cm-bracket">></span>0010<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">option</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">option</span> <span class="cm-attribute">value</span>=<span class="cm-string">"4"</span><span class="cm-tag cm-bracket">></span>0100<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">option</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">option</span> <span class="cm-attribute">value</span>=<span class="cm-string">"8"</span><span class="cm-tag cm-bracket">></span>1000<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">option</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">select</span><span class="cm-tag cm-bracket">></span> = <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">span</span> <span class="cm-attribute">id</span>=<span class="cm-string">"output"</span><span class="cm-tag cm-bracket">></span>0<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-keyword">var</span> <span class="cm-variable">select</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-property">querySelector</span>(<span class="cm-string">"select"</span>);
  <span class="cm-keyword">var</span> <span class="cm-variable">output</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-property">querySelector</span>(<span class="cm-string">"#output"</span>);
  <span class="cm-variable">select</span>.<span class="cm-property">addEventListener</span>(<span class="cm-string">"change"</span>, <span class="cm-keyword">function</span>() {
    <span class="cm-keyword">var</span> <span class="cm-def">number</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;
    <span class="cm-keyword">for</span> (<span class="cm-keyword">var</span> <span class="cm-def">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">select</span>.<span class="cm-property">options</span>.<span class="cm-property">length</span>; <span class="cm-variable-2">i</span><span class="cm-operator">++</span>) {
      <span class="cm-keyword">var</span> <span class="cm-def">option</span> <span class="cm-operator">=</span> <span class="cm-variable">select</span>.<span class="cm-property">options</span>[<span class="cm-variable-2">i</span>];
      <span class="cm-keyword">if</span> (<span class="cm-variable-2">option</span>.<span class="cm-property">selected</span>)
        <span class="cm-variable-2">number</span> <span class="cm-operator">+=</span> <span class="cm-variable">Number</span>(<span class="cm-variable-2">option</span>.<span class="cm-property">value</span>);
    }
    <span class="cm-variable">output</span>.<span class="cm-property">textContent</span> <span class="cm-operator">=</span> <span class="cm-variable-2">number</span>;
  });
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span></pre>
<h2 id="_file_fields">File fields</h2>
<p><a class=p_ident id="p_R18A2rr74T" href="#p_R18A2rr74T"></a>File fields were originally designed as a way to upload files from the
browser&#8217;s machine through a form. In modern browsers, they also
provide a way to read such files from JavaScript programs. The field
acts as a manner of gatekeeper—the script can not simply start reading
private files from the user&#8217;s computer, but when a file has been
selected in such a field, that is understood to mean that the script
may read it.</p>
<p><a class=p_ident id="p_poF7nvM5XY" href="#p_poF7nvM5XY"></a>A file field usually looks like a button labeled something like
“choose file” or “browse”, with information about the chosen file next
to it.</p>
<pre data-language="text/html" class="snippet cm-s-default"><a class=c_ident id="c_k0W0UD/kb6" href="#c_k0W0UD/kb6"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"file"</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-keyword">var</span> <span class="cm-variable">input</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-property">querySelector</span>(<span class="cm-string">"input"</span>);
  <span class="cm-variable">input</span>.<span class="cm-property">addEventListener</span>(<span class="cm-string">"change"</span>, <span class="cm-keyword">function</span>() {
    <span class="cm-keyword">if</span> (<span class="cm-variable">input</span>.<span class="cm-property">files</span>.<span class="cm-property">length</span> <span class="cm-operator">></span> <span class="cm-number">0</span>) {
      <span class="cm-keyword">var</span> <span class="cm-def">file</span> <span class="cm-operator">=</span> <span class="cm-variable">input</span>.<span class="cm-property">files</span>[<span class="cm-number">0</span>];
      <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-string">"You chose"</span>, <span class="cm-variable-2">file</span>.<span class="cm-property">name</span>);
      <span class="cm-keyword">if</span> (<span class="cm-variable-2">file</span>.<span class="cm-property">type</span>)
        <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-string">"It has type"</span>, <span class="cm-variable-2">file</span>.<span class="cm-property">type</span>);
    }
  });
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span></pre>
<p><a class=p_ident id="p_J8fD00m75/" href="#p_J8fD00m75/"></a>The <code>files</code> property of a file field element is an array-like object
(again, not a real array) containing the files chosen in the field. It
is initially empty. The reason there isn&#8217;t simply a <code>file</code> property is
that file fields also support a <code>multiple</code> attribute, which makes it
possible to select multiple files at the same time.</p>
<p><a class=p_ident id="p_d2htjTcaNu" href="#p_d2htjTcaNu"></a>For a singular file field, there will be either zero or one file
objects in the <code>files</code> object. Such an object has properties like
<code>name</code> (the file name), <code>size</code> (the file&#8217;s size in bytes), and <code>type</code>
(the media type of the file, like <code>text/plain</code> or <code>image/jpeg</code>).</p>
<p><a class=p_ident id="p_ezd+X1Rw54" href="#p_ezd+X1Rw54"></a>What it does not have is a property that contains the content of the
file. Getting at that is a little more involved. Since reading a file
from disk can take time, the interface will have to be asynchronous to
avoid freezing the document. You can think of the <code>FileReader</code>
constructor as being similar to <code>XMLHttpRequest</code>, but for files.</p>
<pre data-language="text/html" class="snippet cm-s-default"><a class=c_ident id="c_ax34AWViy0" href="#c_ax34AWViy0"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"file"</span> <span class="cm-attribute">multiple</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-keyword">var</span> <span class="cm-variable">input</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-property">querySelector</span>(<span class="cm-string">"input"</span>);
  <span class="cm-variable">input</span>.<span class="cm-property">addEventListener</span>(<span class="cm-string">"change"</span>, <span class="cm-keyword">function</span>() {
    <span class="cm-variable">Array</span>.<span class="cm-property">prototype</span>.<span class="cm-property">forEach</span>.<span class="cm-property">call</span>(<span class="cm-variable">input</span>.<span class="cm-property">files</span>, <span class="cm-keyword">function</span>(<span class="cm-def">file</span>) {
      <span class="cm-keyword">var</span> <span class="cm-def">reader</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">FileReader</span>();
      <span class="cm-variable-2">reader</span>.<span class="cm-property">addEventListener</span>(<span class="cm-string">"load"</span>, <span class="cm-keyword">function</span>() {
        <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-string">"File"</span>, <span class="cm-variable-2">file</span>.<span class="cm-property">name</span>, <span class="cm-string">"starts with"</span>,
                    <span class="cm-variable-2">reader</span>.<span class="cm-property">result</span>.<span class="cm-property">slice</span>(<span class="cm-number">0</span>, <span class="cm-number">20</span>));
      });
      <span class="cm-variable-2">reader</span>.<span class="cm-property">readAsText</span>(<span class="cm-variable-2">file</span>);
    });
  });
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span></pre>
<p><a class=p_ident id="p_ig0flob0QZ" href="#p_ig0flob0QZ"></a>Reading a file is done by creating a <code>FileReader</code> object, registering
a <code>"load"</code> event handler for it, and calling its <code>readAsText</code> method,
giving it the file we want to read. Once loading finishes, the
reader&#8217;s <code>result</code> property contains the file&#8217;s content.</p>
<p><a class=p_ident id="p_mwjAqF7An3" href="#p_mwjAqF7An3"></a>The example uses <code>Array.prototype.forEach</code> to iterate over the array,
since in a normal loop it would be awkward to get the correct <code>file</code>
and <code>reader</code> objects from the event handler—the variables would be
shared by all iterations of the loop.</p>
<p><a class=p_ident id="p_f5Kaoq//VK" href="#p_f5Kaoq//VK"></a><code>FileReader</code>s also fire an <code>"error"</code> event when reading the file
failed for any reason. The error object itself will end up in the
reader&#8217;s <code>error</code> property. You could wrap it in a <code>Promise</code> (see
Chapter 17) like this:</p>
<pre data-language="javascript" class="snippet cm-s-default"><a class=c_ident id="c_qFF7VzP10k" href="#c_qFF7VzP10k"></a><span class="cm-keyword">function</span> <span class="cm-variable">readFile</span>(<span class="cm-def">file</span>) {
  <span class="cm-keyword">return</span> <span class="cm-keyword">new</span> <span class="cm-variable">Promise</span>(<span class="cm-keyword">function</span>(<span class="cm-def">succeed</span>, <span class="cm-def">fail</span>) {
    <span class="cm-keyword">var</span> <span class="cm-def">reader</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">FileReader</span>();
    <span class="cm-variable-2">reader</span>.<span class="cm-property">addEventListener</span>(<span class="cm-string">"load"</span>, <span class="cm-keyword">function</span>() {
      <span class="cm-variable-2">succeed</span>(<span class="cm-variable-2">reader</span>.<span class="cm-property">result</span>);
    });
    <span class="cm-variable-2">reader</span>.<span class="cm-property">addEventListener</span>(<span class="cm-string">"error"</span>, <span class="cm-keyword">function</span>() {
      <span class="cm-variable-2">fail</span>(<span class="cm-variable-2">reader</span>.<span class="cm-property">error</span>);
    });
    <span class="cm-variable-2">reader</span>.<span class="cm-property">readAsString</span>(<span class="cm-variable-2">file</span>);
  });
}</pre>
<p><a class=p_ident id="p_IGRea9SXwb" href="#p_IGRea9SXwb"></a>It is possible to read only part of a file by calling <code>slice</code> on it,
and passing the result of that (a so-called <em>blob</em> object) to the file
reader.</p>
<h2 id="_fixme_a_bigger_example">FIXME a bigger example</h2>
<h2 id="_summary">Summary</h2>
<p><a class=p_ident id="p_H4fcD/ZhIS" href="#p_H4fcD/ZhIS"></a>Form fields can be inspected and manipulated with JavaScript. They
fire events like <code>"change"</code>, when changed, <code>"input"</code>, when text is
typed, as well as the various keyboard events. These allow us to
notice when the user is interacting with them. Properties like <code>value</code>
(for text and select fields) or <code>checked</code> (for checkboxes and radio
buttons) are used to read or set the field&#8217;s content.</p>
<p><a class=p_ident id="p_nDTREPjblQ" href="#p_nDTREPjblQ"></a>When a form is submitted, its <code>"submit"</code> event fires. A JavaScript
handler can <code>preventDefault</code> that event to prevent the submission from
happening. Form fields elements do not have to be wrapped in <code>&lt;form&gt;</code>
tag, if they are only going to be used by a script.</p>
<h2 id="_exercises">Exercises</h2>
<h3 id="_a_javascript_workbench">A JavaScript workbench</h3>
<p><a class=p_ident id="p_QuAA8G37Ku" href="#p_QuAA8G37Ku"></a>Build an interface that allows people to type and run pieces of
JavaScript.</p>
<p><a class=p_ident id="p_eGmPVJLy/G" href="#p_eGmPVJLy/G"></a>Put a button next to a <code>&lt;textarea&gt;</code> field, which, when pressed, uses
the <code>Function</code> constructor we saw in Chapter 10 to wrap the text in
the field in a function, and call it. Convert the return value of the
function, or any error it raised, to a string and display it below the
text field.</p>
<pre data-language="text/html" class="snippet cm-s-default"><a class=c_ident id="c_5+tTB6edK9" href="#c_5+tTB6edK9"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">textarea</span> <span class="cm-attribute">id</span>=<span class="cm-string">"code"</span><span class="cm-tag cm-bracket">></span>return "hi";<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">textarea</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">button</span> <span class="cm-attribute">id</span>=<span class="cm-string">"button"</span><span class="cm-tag cm-bracket">></span>Run<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">button</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">pre</span> <span class="cm-attribute">id</span>=<span class="cm-string">"output"</span><span class="cm-tag cm-bracket">>&lt;/</span><span class="cm-tag">pre</span><span class="cm-tag cm-bracket">></span>

<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-comment">// Your code here.</span>
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span></pre>
<div class=solution><div class=solution-text>
<p><a class=p_ident id="p_UvZ1ElIw3/" href="#p_UvZ1ElIw3/"></a>Use <code>document.querySelector</code> or <code>document.getElementById</code>, to get
access to the elements defined in your HTML. An event handler for
<code>"click"</code> or <code>"mousedown"</code> events on the button can get the <code>value</code>
property of the text field, and call <code>new Function</code> on it.</p>
<p><a class=p_ident id="p_uLWfzgaSrI" href="#p_uLWfzgaSrI"></a>Make sure you wrap both the call to <code>new Function</code> and the call to its
result in a <code>try</code> block, so that you can catch exceptions that it
produces. In this case, we really don&#8217;t know what type of exception we
are looking for, so catch everything.</p>
<p><a class=p_ident id="p_TWN0owIpP4" href="#p_TWN0owIpP4"></a>The <code>textContent</code> property of the output element can be used to fill
it with a string message. Or, if you want to keep the old content
around, create a new text node using <code>document.createTextNode</code>, and
append it to the element. Remember to add a newline character to the
end, so that not all output appears on a single line.</p>
</div></div>
<h3 id="_autocompletion">Autocompletion</h3>
<p><a class=p_ident id="p_xkMXec3dUE" href="#p_xkMXec3dUE"></a>Extend a text field so that when the user types, a list of suggested
values is shown below the field. You have an array of known common
values, and should show those that start with the text that was typed.
When a suggestion is clicked, replace the text field&#8217;s current value
with it.</p>
<pre data-language="text/html" class="snippet cm-s-default"><a class=c_ident id="c_lL8Xy4GQdp" href="#c_lL8Xy4GQdp"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"text"</span> <span class="cm-attribute">id</span>=<span class="cm-string">"field"</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">id</span>=<span class="cm-string">"suggestions"</span><span class="cm-tag cm-bracket">>&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">></span>

<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-comment">// Builds up an array with global variable names, like</span>
  <span class="cm-comment">// 'alert', 'document', and 'scrollTo'</span>
  <span class="cm-keyword">var</span> <span class="cm-variable">terms</span> <span class="cm-operator">=</span> [];
  <span class="cm-keyword">for</span> (<span class="cm-keyword">var</span> <span class="cm-variable">name</span> <span class="cm-keyword">in</span> <span class="cm-variable">window</span>)
    <span class="cm-variable">terms</span>.<span class="cm-property">push</span>(<span class="cm-variable">name</span>);

  <span class="cm-comment">// Your code here.</span>
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span></pre>
<div class=solution><div class=solution-text>
<p><a class=p_ident id="p_Z5ghBcgWqZ" href="#p_Z5ghBcgWqZ"></a>The best event for updating the suggestion list is <code>"input"</code>, since
that will fire immediately when the content of the field is changed.</p>
<p><a class=p_ident id="p_2CLauByVZn" href="#p_2CLauByVZn"></a>Then loop over the array of terms and see if they start with the given
string, for example by calling <code>indexOf</code> and seeing if the result is
zero. For each matching string, add an element to the suggestions
<code>&lt;div&gt;</code>. You should probably also empty that each time you start
updating the suggestions, for example by setting its <code>textContent</code> to
the empty string.</p>
<p><a class=p_ident id="p_5rUQoI8gua" href="#p_5rUQoI8gua"></a>You could either add a <code>"click"</code> event handler to every suggestion
element, or add a single one to the outer <code>&lt;div&gt;</code> that holds them, and
look at the <code>target</code> property of the event to find out which
suggestion was clicked.</p>
<p><a class=p_ident id="p_JhSLvfJ/T9" href="#p_JhSLvfJ/T9"></a>To get the suggestion text out of a DOM node, you could look at its
<code>textContent</code>, or set an attribute to explicitly store the text when
you create the element.</p>
</div></div>
<h3 id="_conway_8217_s_game_of_life">Conway&#8217;s Game of Life</h3>
<p><a class=p_ident id="p_Jvg4FGRdgU" href="#p_Jvg4FGRdgU"></a>Conway&#8217;s Game of Life is a simple simulation that creates artificial
“life” on a grid, each cell of which is either live or not. Each
generation (turn), the following rules are applied:</p>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Any live cell with fewer than two or more than three live
   neighbors dies.
</p>
</li>
<li>
<p>
Any live cell with two or three live neighbors lives on to the
   next generation.
</p>
</li>
<li>
<p>
Any dead cell with exactly three live neighbors becomes a live
   cell.
</p>
</li>
</ol></div>
<p><a class=p_ident id="p_Lvn5k3FXmI" href="#p_Lvn5k3FXmI"></a>Where a neighbor is defined as any adjacent cell, including diagonally
adjacent ones.</p>
<p><a class=p_ident id="p_9dLS2RK5SZ" href="#p_9dLS2RK5SZ"></a>Note that these rules are applied to the whole grid at once, not one
square at a time. That means that the counting of neighbors is based
on the situation at the start of the generation, and changes happening
to neighbor cells this generation should not influence the new state
of a given cell.</p>
<p><a class=p_ident id="p_W0m8oVpi7M" href="#p_W0m8oVpi7M"></a>Implement this game, taking the grid size as parameters, using
whichever data structure you find appropriate. Use <code>Math.random</code> to
populate the grid with a random pattern initially. Display it as a
grid of checkbox fields, with a button next to it to advance to the
next generation. When the user checks or unchecks the checkboxes,
their changes should be included when computing the next generation.</p>
<pre data-language="text/html" class="snippet cm-s-default"><a class=c_ident id="c_Q11Ch5JZu9" href="#c_Q11Ch5JZu9"></a><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">id</span>=<span class="cm-string">"grid"</span><span class="cm-tag cm-bracket">>&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">br</span><span class="cm-tag cm-bracket">></span> <span class="cm-comment">&lt;!-- &lt;br> inserts a line break --></span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">button</span> <span class="cm-attribute">id</span>=<span class="cm-string">"next"</span><span class="cm-tag cm-bracket">></span>Next generation<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">button</span><span class="cm-tag cm-bracket">></span>

<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span>
  <span class="cm-comment">// Your code here.</span>
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">></span></pre>
<div class=solution><div class=solution-text>
<p><a class=p_ident id="p_Aww6OjjuYz" href="#p_Aww6OjjuYz"></a>To solve the problem of having the changes conceptually happen at the
same time, try to see the computation of a turn as a pure function,
which takes one grid, and produces a new grid that represents the next
turn.</p>
<p><a class=p_ident id="p_xuG6OwlRd8" href="#p_xuG6OwlRd8"></a>Representing the grid can be done in any of the way seen in Chapters 7
and 15. Counting live neighbors can be done with two nested loops,
looping over adjacent coordinates. Take care not to count cells
outside of the field, and to ignore the cell in the center, for which
we are counting.</p>
<p><a class=p_ident id="p_KHncyuOOIQ" href="#p_KHncyuOOIQ"></a>Making changes to checkboxes take affect on the next generation can be
done in two ways. An event handler could notice these changes and
update the current grid to reflect them, or you could generate a fresh
grid from the values in the checkboxes before computing the next turn.</p>
<p><a class=p_ident id="p_wu3Ty9I4d4" href="#p_wu3Ty9I4d4"></a>If you choose to go with event handlers, you might want to attach
attributes that identify the position that each checkbox corresponds
to, so that it is easy to find out which cell to change.</p>
<p><a class=p_ident id="p_XFp+gOIONt" href="#p_XFp+gOIONt"></a>To draw the grid of checkboxes, you can use either a <code>&lt;table&gt;</code> element
(see Chapter 13) or simply put them all in the same element, and
put <code>&lt;br&gt;</code> (line break) elements between the rows.</p>
</div></div>
<nav>
  <a href="17_http.html" title="previous chapter">⬅</a>
  <a href="index.html" title="cover">⬆</a>
  <a href="19_FIXME.html" title="next chapter">➡</a>
</nav>
</article>
